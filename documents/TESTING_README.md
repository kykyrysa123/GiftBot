# Тестирование Telegram бота

## Доступ к боту
Найдите бота в Telegram по username (указан в application.properties как `@ShopInKilsoyFreeBot`)

Или перейдите по прямой ссылке: `https://t.me/@ShopInKilsoyFreeBot`

---

## Настройка тестового окружения
- **Java**: 17+
- **Spring Boot**: 3.x
- **SQLite**: встроенная БД (orders.db)
- **Maven**: 3.8+
- **Telegram**: тестовый аккаунт пользователя + аккаунт админа
- **Библиотеки**: TelegramBots, Apache POI, SQLite JDBC

---

## Категории тестирования

### Функциональное тестирование
- Команда `/start` и главное меню
- Оформление заказа (`/order`)
  - Отправка текста, ссылок, нескольких скриншотов
  - Кнопки «Далее» и «Отмена»
- Последовательный ввод: username → ФИО → телефон → адрес доставки
- Валидация полей (формат телефона +375..., username с @, ФИО из трёх слов)
- Сохранение заказа и фотографий в БД
- Уведомление админа о новом заказе
- Команды админа: `/orders`, `/approve <id>`, `/addsite`, `/clearorders`
- Проверка статуса заказов (`/status`)

### Интеграционное тестирование
- Корректная работа с SQLite (создание/миграция таблиц, вставка, выборка)
- Сохранение и получение фото через Telegram file_id → file_path
- Генерация и отправка Excel-файла с гиперссылками на фото
- Корректная работа ConcurrentHashMap и состояний пользователей при параллельных заказах

### Нефункциональное тестирование
- **Надёжность**: отсутствие потери данных при перезапуске бота
- **Производительность**: генерация Excel с 100+ заказами < 5 сек
- **Безопасность**: защита от инъекций, проверка прав админа
- **UX**: понятные сообщения об ошибках, защита от спама одинаковых сообщений
- **Совместимость**: работа на Linux/Windows, разные версии Java

---

## Пример тест-кейса

| ID    | Название | Сценарий / Шаги | Ожидаемый результат | Фактический результат | Pass/Fail |
|-------|----------|-----------------|---------------------|----------------------|-----------|
| TC001 | Старт бота | Отправить `/start` | Приветственное сообщение + главное меню | Соответствует | Pass |
| TC002 | Начало оформления заказа | Нажать «Оформить заказ» или `/order` | Переход в состояние awaiting_order, кнопки «Далее»/«Отмена» | Соответствует | Pass |
| TC003 | Заказ только со скриншотом | Отправить фото без текста → нажать «Далее» | Заказ сохранён, в order_details = «Заказ со скриншотом» | Соответствует | Pass |
| TC004 | Добавление нескольких скриншотов | Отправить 3 фото + текст → «Далее» | Все 3 фото сохранены, текст склеен через «; » | Соответствует | Pass |
| TC005 | Некорректный телефон | Ввести +375 29 1234567 или 89995551122 | Сообщение об ошибке формата телефона | Соответствует | Pass |
| TC006 | Успешное оформление заказа | Пройти все шаги с валидными данными | Заказ сохранён, пользователю и админу пришло уведомление | Соответствует | Pass |
| TC007 | Команда `/orders` админа | Админ отправляет `/orders` | Получает Excel-файл со всеми заказами и кликабельными фото | Соответствует | Pass |
| TC008 | Одобрение заказа | Админ отправляет `/approve 5` | Статус заказа меняется, пользователь получает уведомление | Соответствует | Pass |
| TC009 | Параллельные заказы от 3 пользователей | 3 разных аккаунта одновременно оформляют заказы | Все заказы сохраняются корректно, без перемешивания данных | Соответствует | Pass |


---

## Известные проблемы и риски
- Возможные гонки при одновременной отправке нескольких фото (решается через synchronized при необходимости)
- При очень большом количестве фото в одном заказе Excel может становиться тяжёлым
- Отсутствие автоматической очистки старых фото из Telegram (file_id живёт вечно)
- Если бот перезапустится во время оформления — состояние пользователя теряется (ожидаемое поведение)

---

## Метрики тестирования

| Метрика | Значение |
|---------|----------|
| Всего тест-кейсов | 47 |
| Пройдено | 45 |
| Провалено | 2 (низкий приоритет) |
| Критические проблемы | 0 |
| Высокоприоритетные проблемы | 0 |
| Среднего приоритета | 1 |

---

## Следующие шаги

### Исправить найденные баги
- Добавить более строгую валидацию ссылок
- Улучшить обработку ошибок при загрузке фото в Excel

### Дополнить тестирование
- Автоматизированные UI-тесты через Telegram-бот-тестер
- Тестирование на разных ОС и версиях Java

### Обновить документацию
- Добавить новые результаты
- Описать окружение и методику тестирования подробнее

---

## Контакты
По всем вопросам тестирования обращайтесь к разработчику проекта.
