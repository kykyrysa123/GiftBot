# Telegram Бот для заказов – Анализ вариантов использования

## Акторы

### **Пользователь (Неавторизованный)**
Пользователь, который еще не начал взаимодействие с ботом. Может просматривать информацию и начинать оформление заказа.

### **Пользователь (В процессе оформления)**
Пользователь, который начал процесс оформления заказа. Может вводить данные и отправлять скриншоты.

### **Администратор**
Системный администратор. Может просматривать заказы, одобрять их, экспортировать данные и управлять базой данных.

### **Система / Telegram API**
Внешняя система для обработки сообщений и файлов.

## Сценарии вариантов использования

### **UC1: Оформление заказа**

**Актор:** Пользователь  
**Предусловие:** Пользователь авторизован в Telegram и начал взаимодействие с ботом.

**Поток событий:**
1. Пользователь отправляет команду /start
2. Бот отображает приветственное сообщение и главное меню
3. Пользователь нажимает "Оформить заказ" или отправляет /order
4. Система переводит пользователя в состояние awaiting_order
5. Пользователь отправляет данные заказа:
   - Текст описания
   - Ссылки на товары
   - Скриншоты (один или несколько)
6. Пользователь нажимает "Далее"
7. Система последовательно запрашивает:
   - Username (обязательно с @)
   - ФИО (три слова)
   - Телефон (в формате +375...)
   - Адрес доставки
8. На каждом шаге система валидирует введенные данные
9. После успешного заполнения всех полей заказ сохраняется в БД

**Альтернативные потоки:**
- Неверный формат телефона → "Неверный формат телефона. Используйте формат +375..."
- Неверный username → "Username должен начинаться с @"
- Неполное ФИО → "Введите ФИО тремя словами"
- Пользователь нажимает "Отмена" → Возврат в главное меню
- Пользователь не отправляет текст → order_details = "Заказ со скриншотом"

**Постусловие:** Заказ создан и сохранен в системе, администратор получает уведомление.

---

### **UC2: Управление списком сайтов**

**Актор:** Пользователь  
**Предусловие:** Пользователь находится в процессе оформления заказа.

**Поток событий:**
1. Пользователь вводит ссылки на товары в описание заказа
2. Система проверяет валидность URL-адресов
3. Если ссылки валидны, они сохраняются в поле order_details
4. Ссылки отображаются в Excel отчете для администратора

**Альтернативные потоки:**
- Некорректный формат ссылки → Ссылка сохраняется без валидации (требует улучшения)
- Пользователь не вводит ссылки → Поле остается пустым

**Постусловие:** Ссылки на товары сохранены и доступны для просмотра администратором.

---

### **UC3: Одобрение заказа (Администратор)**

**Актор:** Администратор  
**Предусловие:** Администратор авторизован и имеет соответствующие права.

**Поток событий:**
1. Администратор отправляет команду /approve <id_заказа>
2. Система ищет заказ по указанному ID в базе данных
3. Если заказ найден, система изменяет его статус на "одобрен"
4. Пользователь получает уведомление об одобрении заказа
5. Заказ отмечается как обработанный в системе

**Альтернативные потоки:**
- Заказ не найден → "Заказ с ID <id> не найден"
- Неверный формат команды → "Используйте: /approve <id_заказа>"

**Постусловие:** Статус заказа изменен, пользователь уведомлен о результате.

---

### **UC4: Экспорт заказов в Excel**

**Актёр:** Администратор  
**Предусловие:** Администратор авторизован и имеет соответствующие права.

**Поток событий:**
1. Администратор отправляет команду /orders
2. Система извлекает все заказы из базы данных
3. Генерируется Excel-файл со следующими колонками:
   - ID заказа
   - Username пользователя
   - ФИО
   - Телефон
   - Адрес доставки
   - Детали заказа
   - Статус заказа
4. Создаются гиперссылки на прикрепленные фотографии
5. Система отправляет сгенерированный Excel-файл администратору

**Альтернативные потоки:**
- Нет заказов в базе → "Нет заказов для отображения"
- Ошибка генерации файла → "Ошибка при создании отчета"

**Постусловие:** Администратор получает полный отчет по заказам в формате Excel.

---

### **UC5: Обработка фотографий в заказе**

**Актёр:** Пользователь  
**Предусловие:** Пользователь находится в процессе оформления заказа.

**Поток событий:**
1. Пользователь отправляет один или несколько скриншотов
2. Система получает file_id от Telegram API
3. file_id сохраняется в базе данных
4. Устанавливается связь между фотографиями и заказом
5. При экспорте в Excel создаются гиперссылки на фотографии

**Альтернативные потоки:**
- Пользователь отправляет несколько фото → Все file_id сохраняются, разделенные через ";"
- Пользователь не отправляет фото → order_details = "Заказ со скриншотом"
- Ошибка загрузки фото → Система продолжает обработку заказа

**Постусловие:** Фотографии сохранены и доступны для просмотра администратором через Excel отчет.

---

### **UC6: Проверка статуса заказа**

**Актёр:** Пользователь  
**Предусловие:** Пользователь имеет оформленные заказы.

**Поток событий:**
1. Пользователь отправляет команду /status
2. Система проверяет наличие заказов пользователя
3. Отображается статус последнего заказа или список всех заказов
4. Пользователь видит текущее состояние своего заказа

**Альтернативные потоки:**
- Нет заказов → "У вас нет активных заказов"
- Заказ не найден → "Информация о заказе недоступна"

**Постусловие:** Пользователь информирован о статусе своих заказов.
